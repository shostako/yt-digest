# 2025-12 作業ログ

## 2025-12-07 Renderデプロイ完了・YouTube URL直接処理への移行

### 実施内容

#### Renderデプロイ
- フロントエンド（Node.js）とバックエンド（Python）をRenderにデプロイ
- フロントエンドのRuntime設定ミス（Python3→Node）で作り直し
- 環境変数設定（GEMINI_API_KEY, YOUTUBE_API_KEY, NEXT_PUBLIC_API_URL）

#### youtube-transcript-api 問題
- **問題**: クラウドプロバイダー（Render）のIPがYouTubeにブロックされる
- **症状**: ローカルでは動くが、Renderデプロイ後に字幕取得失敗
- **原因**: YouTubeがボット対策でクラウドIPからのスクレイピングをブロック

#### 解決策: Gemini直接URL処理
- youtube-transcript-apiを廃止
- Gemini APIにYouTube URLを直接渡す方式に変更
- 参考: https://ai.google.dev/gemini-api/docs/video-understanding

#### Quota最適化
- **問題**: Pro→Flashフォールバックで2回リクエスト送信、Quota2倍消費
- **解決**: Flashモデルのみに変更、YouTube動画処理はトークン消費が大きいため

### 技術的発見
- Gemini APIはYouTube URLを`file_data.file_uri`で直接渡せる（プレビュー機能）
- YouTube動画処理は1日8時間分まで、現在無料
- 動画処理は字幕テキストより大量のトークンを消費する

### コミット履歴
```
8328f1e perf: YouTube動画処理はFlashのみに変更
856011c refactor: youtube-transcript-apiを廃止、Gemini直接URL処理に移行
84db03c chore: Render デプロイ設定追加
```

## 2025-12-08 Obsidian保存機能をURI scheme方式に変更

### 問題
- 「Obsidianに保存」ボタンがエラー: `Permission denied: '/mnt/c'`
- 原因: バックエンドがWSLパス（`/mnt/c/...`）でファイル保存しようとしていた
- Renderサーバー上には`/mnt/c`は存在しない（WSL環境専用のパス）

### 解決策
- バックエンドAPI保存方式を廃止
- Obsidian URI scheme（`obsidian://new`）方式に変更
- フロントエンド側で完結する実装

### 実装内容
- `obsidian://new?vault=...&file=...&content=...` 形式のURIを生成
- 設定項目を「Windowsパス」→「Vault名」+「フォルダパス」に変更
- フロントマター生成をフロントエンド側で実行

### 結果
- Obsidianが起動して新規ノートが即座に開かれる
- 以前の方式よりUXが向上（ファイル保存→手動で開く、が不要に）

### コミット履歴
```
15a270a feat: Obsidian URI scheme方式に変更
```
