# 2025-12 作業ログ

## 2025-12-07 Renderデプロイ完了・YouTube URL直接処理への移行

### 実施内容

#### Renderデプロイ
- フロントエンド（Node.js）とバックエンド（Python）をRenderにデプロイ
- フロントエンドのRuntime設定ミス（Python3→Node）で作り直し
- 環境変数設定（GEMINI_API_KEY, YOUTUBE_API_KEY, NEXT_PUBLIC_API_URL）

#### youtube-transcript-api 問題
- **問題**: クラウドプロバイダー（Render）のIPがYouTubeにブロックされる
- **症状**: ローカルでは動くが、Renderデプロイ後に字幕取得失敗
- **原因**: YouTubeがボット対策でクラウドIPからのスクレイピングをブロック

#### 解決策: Gemini直接URL処理
- youtube-transcript-apiを廃止
- Gemini APIにYouTube URLを直接渡す方式に変更
- 参考: https://ai.google.dev/gemini-api/docs/video-understanding

#### Quota最適化
- **問題**: Pro→Flashフォールバックで2回リクエスト送信、Quota2倍消費
- **解決**: Flashモデルのみに変更、YouTube動画処理はトークン消費が大きいため

### 技術的発見
- Gemini APIはYouTube URLを`file_data.file_uri`で直接渡せる（プレビュー機能）
- YouTube動画処理は1日8時間分まで、現在無料
- 動画処理は字幕テキストより大量のトークンを消費する

### コミット履歴
```
8328f1e perf: YouTube動画処理はFlashのみに変更
856011c refactor: youtube-transcript-apiを廃止、Gemini直接URL処理に移行
84db03c chore: Render デプロイ設定追加
```
